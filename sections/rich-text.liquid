{%- if section.blocks.size > 0 -%}
  {%- render 'section-spacing-collapsing' -%}

  <style>
    #shopify-section-{{ section.id }} {
      --rich-text-max-width: {% if section.settings.content_width == 'small' %}650px{% elsif section.settings.content_width == 'medium' %}780px{% else %}100%{% endif %};
    }

    /* Styles ajout√©s pour couleur et italique */
    #shopify-section-{{ section.id }} .prose,
    #shopify-section-{{ section.id }} .prose *:not(a):not(button):not([class*="btn"]) {
      color: #772647 !important;
      font-style: italic !important;
    }

    #shopify-section-{{ section.id }} .prose strong {
      font-style: italic !important;
    }
  </style>

  <div {% render 'section-properties' %}>
    {%- assign text_position = section.settings.text_position -%}
    {%- assign blocks_before_divider = '' -%}
    {%- assign blocks_after_divider = '' -%}

    {%- for block in section.blocks -%}
      {%- capture block_content -%}
        {%- case block.type -%}
          {%- when 'subheading' -%}
            {%- if block.settings.text != blank -%}
              <p class="bold" {{ block.shopify_attributes }}>{{ block.settings.text | escape }}</p>
            {%- endif -%}

          {%- when 'heading' -%}
            {%- if block.settings.text != blank -%}
              <p class="{{ block.settings.heading_tag }} hyphenate" {{ block.shopify_attributes }}>
                {%- render 'styled-text', content: block.settings.text, text_color: block.settings.text_color, gradient: block.settings.gradient -%}
              </p>
            {%- endif -%}

          {%- when 'richtext' -%}
            {%- if block.settings.content != blank -%}
              <div {{ block.shopify_attributes }}>
                {{- block.settings.content -}}
              </div>
            {%- endif -%}

          {%- when 'page' -%}
            {%- if block.settings.page.content != blank -%}
              <div {{ block.shopify_attributes }}>
                {{- block.settings.page.content -}}
              </div>
            {%- endif -%}

          {%- when 'liquid' -%}
            {%- if block.settings.liquid != blank -%}
              <div {{ block.shopify_attributes }}>
                {{- block.settings.liquid -}}
              </div>
            {%- endif -%}

          {%- when 'image' -%}
            {%- if block.settings.image != blank -%}
              <div {{ block.shopify_attributes }} style="margin-block-start: 0">
                {%- capture image_style_attribute -%}{% if section.settings.text_position == 'center' %}margin-inline: auto;{% endif %}{%- endcapture -%}

                {%- if block.settings.width_mode == 'custom' -%}
                  {%- capture image_style_attribute -%}{{ image_style_attribute }} --image-max-width: {{ block.settings.max_width }}px; --image-mobile-max-width: {{ block.settings.mobile_max_width }}px{%- endcapture -%}
                  {%- capture image_sizes_attribute -%}(max-width: 699px) min({{ block.settings.mobile_max_width }}px, 100vw), min({{ block.settings.max_width }}px, 100vw){%- endcapture -%}
                {%- else -%}
                  {%- capture image_sizes_attribute -%}min(100vw, var(--page-width)){%- endcapture -%}
                {%- endif -%}

                {{- block.settings.image | image_url: width: block.settings.image.width | image_tag: loading: 'lazy', sizes: image_sizes_attribute, widths: '200,300,400,500,600,800,1000,1200,1400,1600', style: image_style_attribute -}}
              </div>
            {%- endif -%}

          {%- when 'button' -%}
            {%- if block.settings.text != blank -%}
              {% render 'button', content: block.settings.text, href: block.settings.url, size: block.settings.size, style: block.settings.style, background: block.settings.background, text_color: block.settings.text_color, block: block %}
            {%- endif -%}

          {%- when 'icon' -%}
            {%- capture icon -%}
              {%- if block.settings.custom_icon != blank -%}
                {%- capture sizes -%}{{ block.settings.icon_width }}px{%- endcapture -%}
                {%- capture widths -%}{{ block.settings.icon_width }}, {{ block.settings.icon_width | times: 2 | at_most: block.settings.custom_icon.width }}{%- endcapture -%}
                {%- capture style -%}--icon-max-width: {{ block.settings.icon_width }}px{%- endcapture -%}
                {{- block.settings.custom_icon | image_url: width: block.settings.custom_icon.width | image_tag: loading: 'lazy', sizes: sizes, widths: widths, style: style, class: 'image-icon' -}}
              {%- else -%}
                {%- render 'icon' with block.settings.icon, width: block.settings.icon_width, height: block.settings.icon_width -%}
              {%- endif -%}
            {%- endcapture -%}

            {%- if icon != blank -%}
              <div {{ block.shopify_attributes }}>
                {%- if block.settings.icon_background_type == 'none' -%}
                  <div {% render 'surface', text_color: block.settings.icon_color %}>
                    {{- icon -}}
                  </div>
                {%- else -%}
                  {%- capture surface_class -%}icon-block {% if block.settings.icon_background_type == 'circle' %}rounded-full{% endif %}{%- endcapture -%}
                  <div {% render 'surface', class: surface_class, background: block.settings.icon_background, text_color: block.settings.icon_color, background_fallback: 'bg-secondary' %}>
                    {{- icon -}}
                  </div>
                {%- endif -%}
              </div>
            {%- endif -%}

          {%- when 'divider' -%}
            {%- assign divider_index = forloop.index -%}
        {%- endcase -%}
      {%- endcapture -%}

      {%- if divider_index == blank or forloop.index < divider_index -%}
        {%- assign blocks_before_divider = blocks_before_divider | append: block_content -%}
      {%- else -%}
        {%- assign blocks_after_divider = blocks_after_divider | append: block_content -%}
      {%- endif -%}
    {%- endfor -%}

    {%- if blocks_before_divider != blank and blocks_after_divider != blank -%}
      <div class="split-rich-text">
        <div class="prose justify-items-{{ text_position }} text-{{ text_position }}">
          {{- blocks_before_divider -}}
        </div>

        <div class="prose justify-items-{{ text_position }} text-{{ text_position }}">
          {{- blocks_after_divider -}}
        </div>
      </div>
    {%- endif -%}

    <div class="rich-text justify-{{ text_position }} {% if blocks_before_divider != blank and blocks_after_divider != blank %}md:hidden{% endif %}">
      <div class="rich-text__wrapper">
        <div class="prose justify-items-{{ text_position }} text-{{ text_position }}">
          {{- blocks_before_divider -}}
          {{- blocks_after_divider -}}
        </div>
      </div>
    </div>
  </div>
{%- endif -%}